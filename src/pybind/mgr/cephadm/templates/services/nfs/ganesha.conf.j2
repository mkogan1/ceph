# {{ cephadm_managed }}
NFS_CORE_PARAM {
        Enable_NLM = {{ enable_nlm }};
        Enable_RQUOTA = false;
        Protocols = 3, 4;
        mount_path_pseudo = true;
        Enable_UDP = false;
        NFS_Port = {{ port }};
        allow_set_io_flusher_fail = true;
{% if bind_addr %}
        Bind_addr = {{ bind_addr }};
{% endif %}
{% if haproxy_hosts %}
        HAProxy_Hosts = {{ haproxy_hosts|join(", ") }};
{% endif %}
{% if monitoring_addr %}
	Monitoring_Addr = {{ monitoring_addr }};
{% endif %}
        Monitoring_Port = {{ monitoring_port }};
}

NFSv4 {
        Delegations = false;
        RecoveryBackend = "rados_cluster";
        Minor_Versions = 1, 2;
        Server_Scope = "{{ cluster_id }}-{{ namespace }}";
{% if nfs_idmap_conf %}
        IdmapConf = "{{ nfs_idmap_conf }}";
{% endif %}
        Virtual_Server = {{ enable_virtual_server }};
}

MDCACHE {
        Dir_Chunk = 0;
}

RADOS_KV {
        UserId = "{{ user }}";
        nodeid = "{{ nodeid }}";
        pool = "{{ pool }}";
        namespace = "{{ namespace }}";
}

RADOS_URLS {
        UserId = "{{ user }}";
        watch_url = "{{ url }}";
}

RGW {
        cluster = "ceph";
        name = "client.{{ rgw_user }}";
}
{% if use_old_nodeid %}

Ceph {
        Use_old_uuid = true;
}
{% endif %}
{% if kmip_addrs %}

%plugin ganesha/libkmip_fscrypt.so
KMIP {
{% for kmip_addr in kmip_addrs %}
        HOST {
                addr = "{{  kmip_addr.get('addr', '') }}";
{% if kmip_addr.get('port') %}
                port = {{  kmip_addr.get('port') }};
{% endif %}
{% if 'servername' in kmip_addr %}
                servername = "{{  kmip_addr.get('servername') }}";
{% endif %}
{% if 'verify_hostname' in kmip_addr %}
                verify_hostname = "{{  kmip_addr.get('verify_hostname') }}";
{% endif %}
        }
{% endfor %}
        cert = /etc/ganesha/kmip/kmip_cert.pem;
        key = /etc/ganesha/kmip/kmip_key.pem;
        ca = /etc/ganesha/kmip/kmip_ca_cert.pem;
}
{% endif %}

%url    {{ url }}
